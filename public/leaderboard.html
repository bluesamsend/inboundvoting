<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inbound Pitch Competition - Live Leaderboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .leaderboard-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .main-title {
            font-size: 48px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 20px;
            color: #718096;
            margin-bottom: 20px;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #007AFF;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .podium {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px;
            margin-bottom: 50px;
            min-height: 300px;
        }

        .podium-place {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            transition: transform 0.3s ease;
            border: 3px solid transparent;
        }

        .podium-place:hover {
            transform: translateY(-5px);
        }

        .podium-place.first {
            order: 2;
            height: 280px;
            border-color: #FFD700;
            background: linear-gradient(135deg, #fff9e6 0%, #fff3cd 100%);
        }

        .podium-place.second {
            order: 1;
            height: 240px;
            border-color: #C0C0C0;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .podium-place.third {
            order: 3;
            height: 200px;
            border-color: #CD7F32;
            background: linear-gradient(135deg, #fdf2e9 0%, #f4e4d6 100%);
        }

        .medal {
            position: absolute;
            top: -15px;
            right: -15px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .medal.first { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .medal.second { background: linear-gradient(135deg, #C0C0C0, #A8A8A8); }
        .medal.third { background: linear-gradient(135deg, #CD7F32, #B8860B); }



        .place-label {
            font-size: 16px;
            font-weight: bold;
            color: #666;
            margin-bottom: 10px;
        }

        .company-name {
            font-size: 22px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .company-website {
            font-size: 14px;
            color: #007AFF;
            margin-bottom: 15px;
            text-decoration: none;
        }

        .company-website:hover {
            text-decoration: underline;
        }

        .vote-count {
            font-size: 32px;
            font-weight: bold;
            color: #007AFF;
        }

        .full-leaderboard {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .leaderboard-header {
            background: linear-gradient(135deg, #007AFF, #005bb5);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .leaderboard-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .table-header {
            display: grid;
            grid-template-columns: 100px 1fr 120px 100px;
            padding: 20px 25px;
            background: #f8f9fa;
            font-weight: bold;
            color: #2d3748;
            border-bottom: 2px solid #e9ecef;
        }

        .leaderboard-row {
            display: grid;
            grid-template-columns: 100px 1fr 120px 100px;
            padding: 20px 25px;
            border-bottom: 1px solid #e9ecef;
            align-items: center;
            transition: background-color 0.3s ease;
        }

        .leaderboard-row:hover {
            background: #f8f9fa;
        }

        .rank-display {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rank-number {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 18px;
        }

        .rank-number.gold { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .rank-number.silver { background: linear-gradient(135deg, #C0C0C0, #A8A8A8); }
        .rank-number.bronze { background: linear-gradient(135deg, #CD7F32, #B8860B); }
        .rank-number.other { background: linear-gradient(135deg, #6c757d, #5a6268); }

        .company-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }



        .company-details h3 {
            font-size: 18px;
            color: #2d3748;
            margin-bottom: 2px;
        }

        .company-details a {
            font-size: 14px;
            color: #007AFF;
            text-decoration: none;
        }

        .company-details a:hover {
            text-decoration: underline;
        }

        .vote-display {
            text-align: center;
        }

        .vote-number {
            font-size: 24px;
            font-weight: bold;
            color: #007AFF;
        }

        .vote-percentage {
            font-size: 14px;
            color: #666;
            margin-top: 2px;
        }

        .last-updated {
            text-align: center;
            color: #666;
            margin-top: 20px;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 50px;
            color: #dc3545;
            font-size: 18px;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .refreshing {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <div class="leaderboard-container">
        <div class="header">
            <h1 class="main-title">Ultimate Pitch Showdown</h1>
            <p class="subtitle">Vote For The Best Pitch At Inbound25. Sendblue Will Donate $10,000 To The Winning Business's Charity Of Choice</p>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalVotes">0</div>
                    <div class="stat-label">Total Votes</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="totalCompanies">0</div>
                    <div class="stat-label">Companies</div>
                </div>
            </div>
        </div>

        <div class="podium" id="podium">
            <!-- Top 3 will be inserted here -->
        </div>

        <div class="full-leaderboard">
            <div class="leaderboard-header">
                <h2 class="leaderboard-title">Complete Rankings</h2>
            </div>
            
            <div class="table-header">
                <div>Rank</div>
                <div>Company</div>
                <div>Votes</div>
                <div>%</div>
            </div>
            
            <div id="leaderboardTable">
                <div class="loading">Loading leaderboard...</div>
            </div>
        </div>

        <div class="last-updated" id="lastUpdated"></div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'https://inboundvoting-production.up.railway.app/api';
        const REFRESH_INTERVAL = 5000; // 5 seconds

        let refreshTimer;

        // Fetch leaderboard data
        async function fetchLeaderboard() {
            try {
                const response = await fetch(`${API_BASE_URL}/leaderboard`);
                if (!response.ok) throw new Error('Failed to fetch leaderboard');
                
                const data = await response.json();
                updateLeaderboard(data);
                
            } catch (error) {
                console.error('Error fetching leaderboard:', error);
                showError('Unable to load leaderboard data');
            }
        }

        // Update the leaderboard display
        function updateLeaderboard(data) {
            const { leaderboard, totalVotes, lastUpdated } = data;
            
            // Update stats
            document.getElementById('totalVotes').textContent = totalVotes;
            document.getElementById('totalCompanies').textContent = leaderboard.length;
            
            // Update podium (top 3)
            updatePodium(leaderboard.slice(0, 3));
            
            // Update full table
            updateTable(leaderboard);
            
            // Update timestamp
            const updateTime = new Date(lastUpdated).toLocaleString();
            document.getElementById('lastUpdated').textContent = `Last updated: ${updateTime}`;
        }

        // Update podium display
        function updatePodium(topThree) {
            const podium = document.getElementById('podium');
            podium.innerHTML = '';
            
            // Ensure we have exactly 3 positions, fill with TBD if needed
            while (topThree.length < 3) {
                topThree.push({ name: 'TBD', votes: 0, website: '', rank: topThree.length + 1 });
            }
            
            // Map companies to their correct podium positions
            const first = topThree[0]; // 1st place (highest votes)
            const second = topThree[1]; // 2nd place
            const third = topThree[2]; // 3rd place
            
            const positions = [
                { company: second, position: 'second', label: '2nd Place', medal: '2' },
                { company: first, position: 'first', label: '1st Place', medal: '1' },
                { company: third, position: 'third', label: '3rd Place', medal: '3' }
            ];
            
            positions.forEach(({ company, position, label, medal }) => {
                const placeDiv = document.createElement('div');
                placeDiv.className = `podium-place ${position}`;
                
                placeDiv.innerHTML = `
                    <div class="medal ${position}">${medal}</div>
                    <div class="place-label">${label}</div>
                    <div class="company-name">${company.name}</div>
                    ${company.website ? `<a href="${company.website}" class="company-website" target="_blank">${company.website}</a>` : ''}
                    <div class="vote-count">${company.votes}</div>
                `;
                
                podium.appendChild(placeDiv);
            });
        }

        // Update table display
        function updateTable(leaderboard) {
            const table = document.getElementById('leaderboardTable');
            
            if (leaderboard.length === 0) {
                table.innerHTML = '<div class="loading">No companies added yet</div>';
                return;
            }
            
            table.innerHTML = leaderboard.map(company => {
                const rankClass = company.rank === 1 ? 'gold' : 
                                company.rank === 2 ? 'silver' : 
                                company.rank === 3 ? 'bronze' : 'other';
                
                return `
                    <div class="leaderboard-row">
                        <div class="rank-display">
                            <div class="rank-number ${rankClass}">${company.rank}</div>
                        </div>
                        <div class="company-info">
                            <div class="company-details">
                                <h3>${company.name}</h3>
                                ${company.website ? `<a href="${company.website}" target="_blank">${company.website}</a>` : ''}
                            </div>
                        </div>
                        <div class="vote-display">
                            <div class="vote-number">${company.votes}</div>
                        </div>
                        <div class="vote-display">
                            <div class="vote-number">${company.percentage}%</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Show error message
        function showError(message) {
            document.getElementById('leaderboardTable').innerHTML = 
                `<div class="error">${message}</div>`;
        }

        // Auto-refresh functionality
        function startAutoRefresh() {
            refreshTimer = setInterval(() => {
                document.body.classList.add('refreshing');
                fetchLeaderboard().finally(() => {
                    setTimeout(() => {
                        document.body.classList.remove('refreshing');
                    }, 300);
                });
            }, REFRESH_INTERVAL);
        }

        function stopAutoRefresh() {
            if (refreshTimer) {
                clearInterval(refreshTimer);
                refreshTimer = null;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            fetchLeaderboard();
            startAutoRefresh();
        });

        // Handle page visibility for performance
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                stopAutoRefresh();
            } else {
                startAutoRefresh();
                fetchLeaderboard();
            }
        });

        // Handle window focus/blur
        window.addEventListener('focus', () => {
            fetchLeaderboard();
        });
    </script>
</body>
</html>
